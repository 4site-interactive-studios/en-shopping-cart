(()=>{"use strict";new(function(){function t(){var t=this;this.cardsNode=document.querySelectorAll(".sc-cards > div:not(.block-other)"),this.total=0,this.currencies={USD:"$",EUR:"€",GBP:"£",CAD:"$"},this.isDebug()&&console.log("Shopping Cart: Debug mode is on"),this.shouldRun()?"loading"!==document.readyState?this.run():document.addEventListener("DOMContentLoaded",(function(){t.run()})):console.log("Shopping Cart Not Running")}return t.prototype.shouldRun=function(){return this.cardsNode.length>0},t.prototype.setCardsAtttributes=function(){var t=this,e=JSON.parse(localStorage.getItem("sc-cards-".concat(this.getPageId()))||"[]");this.cardsNode.forEach((function(n,a){var r=n.querySelector("h1 + p, h2 + p, h3 + p, h4 + p, h5 + p, h6 + p");if(r){var i=r.innerText.match(/\d+/g),o=i?parseInt(i.join(""),10):0,c=e[a]||0;o>0&&(n.setAttribute("data-amount",o.toString()),n.setAttribute("data-quantity",c.toString()),n.setAttribute("data-card",a.toString()),n.setAttribute("data-currency",t.getCurrency(n)),c>0&&n.setAttribute("data-selected","true"))}}))},t.prototype.createCardsAmounts=function(){var t=this;this.cardsNode.forEach((function(e){var n=t.getCardAmount(e),a=t.getCurrency(e),r=document.createElement("div");r.classList.add("sc-cards-amount"),r.innerHTML='<span class="currency">'.concat(a,'</span><span class="amount">').concat(n,"</span>"),e.appendChild(r)}))},t.prototype.createCardsQuantity=function(){var t=this;this.cardsNode.forEach((function(e){var n=e.querySelector("h1 + p, h2 + p, h3 + p, h4 + p, h5 + p, h6 + p"),a=t.getCardQuantity(e),r=document.createElement("div");r.classList.add("sc-cards-quantity"),r.innerHTML='\n        <div class="decrease"></div>\n        <div class="quantity">'.concat(a,'</div>\n        <div class="increase"></div>\n      '),n.parentNode.insertBefore(r,n.nextSibling)}))},t.prototype.increaseQuantity=function(t){var e=this.getCardQuantity(t)+1;t.setAttribute("data-quantity",e.toString()),t.setAttribute("data-selected","true")},t.prototype.decreaseQuantity=function(t){var e=this.getCardQuantity(t);if(e>0){var n=e-1;t.setAttribute("data-quantity",n.toString()),0===n&&t.removeAttribute("data-selected")}},t.prototype.getCardAmount=function(t){var e=t.getAttribute("data-amount");return e?parseInt(e,10):0},t.prototype.getCurrency=function(t){if(t){var e=t.getAttribute("data-currency");if(e)return e;if(t.classList.contains("euro")||t.classList.contains("eur"))return this.currencies.EUR;if(t.classList.contains("pound")||t.classList.contains("gbp"))return this.currencies.GBP;if(t.classList.contains("dollar")||t.classList.contains("usd"))return this.currencies.USD;if(t.classList.contains("canadian")||t.classList.contains("cad"))return this.currencies.CAD}var n=document.querySelector('[name="transaction.paycurrency"]');return n&&n.value in this.currencies?this.currencies[n.value]:"$"},t.prototype.getCardQuantity=function(t){var e=t.getAttribute("data-quantity");return e?parseInt(e,10):0},t.prototype.watchForQuantityChanges=function(){var t=this,e=new MutationObserver((function(e){e.forEach((function(e){if("attributes"===e.type){var n=e.target,a=n.querySelector(".sc-cards-quantity > .quantity");a&&(a.innerText=t.getCardQuantity(n).toString()),t.rememberQuantity(),t.updateTotal()}}))}));this.cardsNode.forEach((function(t){e.observe(t,{attributes:!0,attributeFilter:["data-quantity"]})}))},t.prototype.addOtherAmount=function(){var t=this,e=document.querySelector(".block-other");if(e){var n=localStorage.getItem("sc-cards-".concat(this.getPageId(),"-other"))||"0";"0"!==n&&e.setAttribute("data-selected","true");var a=this.getCurrency(e),r=Object.keys(this.currencies).find((function(e){return t.currencies[e]===a})),i=document.createElement("div");i.classList.add("block-other-amount"),i.innerHTML='\n      <span class="currency-symbol">'.concat(a,'</span>\n      <input id="sc-other-amount" type="text" inputmode="decimal" data-lpignore="true" autocomplete="off" value="').concat(n,'" tabindex="1">\n      <span class="currency-code">').concat(r,"</span>\n      "),e.appendChild(i);var o=e.querySelector("input");o&&(o.addEventListener("input",(function(n){var a=n.target.value||"0";localStorage.setItem("sc-cards-".concat(t.getPageId(),"-other"),a),"0"===a?e.removeAttribute("data-selected"):e.setAttribute("data-selected","true"),t.updateTotal()})),o.addEventListener("focus",(function(t){"0"===t.target.value&&(t.target.value="")})))}},t.prototype.addMonthlyCheckbox=function(){var t=this,e=document.querySelector(".monthly-checkbox");if(e){var n=localStorage.getItem("sc-cards-".concat(this.getPageId(),"-monthly"))||"N";"N"!==n&&e.setAttribute("data-selected","true");var a='\n      <input id="sc-monthly" value="Y" type="checkbox" '.concat("Y"===n?"checked='checked'":"",">\n      ");e.innerHTML=a+'<label for="sc-monthly">'+e.innerHTML+"</label>";var r=e.querySelector("input");r&&r.addEventListener("change",(function(n){var a=n.target.checked?"Y":"N";localStorage.setItem("sc-cards-".concat(t.getPageId(),"-monthly"),a),"N"===a?e.removeAttribute("data-selected"):e.setAttribute("data-selected","true"),t.updateFrequency(),t.updateTotal()}))}},t.prototype.addLiveVariables=function(){var t=document.querySelectorAll(".en__component--copyblock, .en__component--codeblock, .en__submit button");t.length>0&&t.forEach((function(t){if(t.innerText.includes("[[")){var e=t.innerText.match(/\[\[(.*?)\]\]/g);e&&e.forEach((function(e){var n=e.replace(/\[\[/g,"").replace(/\]\]/g,"");t.innerHTML=t.innerHTML.replace("[[".concat(n,"]]"),"<span class='sc-live-variable' data-variable='"+n+"'></span>")}))}}))},t.prototype.updateLiveVariables=function(t,e){var n=document.querySelectorAll(".sc-live-variable[data-variable='"+t+"']");n.length>0&&n.forEach((function(t){t.innerText=e}))},t.prototype.updateTotal=function(){var t=this;this.total=0,this.cardsNode.forEach((function(e){var n=t.getCardAmount(e),a=t.getCardQuantity(e);t.total+=n*a}));var e=document.querySelector("#sc-other-amount");if(e){var n=parseFloat(parseFloat(e.value).toFixed(2));n>0&&(this.total+=n)}this.isDebug()&&console.log("Shopping Cart Total:",this.total);var a=document.querySelector("[name='transaction.donationAmt.other']");return a&&(a.value=this.total.toString()),window.EngagingNetworks.require._defined.enjs.setFieldValue("donationAmt",this.total),this.updateLiveVariables("TOTAL",this.total.toString()),this.total},t.prototype.updateFrequency=function(){var t=document.querySelector("#sc-monthly");if(t){var e=t.checked?"Y":"N";window.EngagingNetworks.require._defined.enjs.setFieldValue("recurrpay",e)}if("Y"===window.EngagingNetworks.require._defined.enjs.getFieldValue("recurrpay")){var n=document.querySelector("[name='transaction.recurrpay'][value='Y'] + label");n?this.updateLiveVariables("FREQUENCY",n.innerText):this.updateLiveVariables("FREQUENCY","Monthly")}else this.updateLiveVariables("FREQUENCY","")},t.prototype.setQuantityClickEvent=function(){var t=this;this.cardsNode.forEach((function(e){var n=e.querySelector(".sc-cards-quantity > .increase"),a=e.querySelector(".sc-cards-quantity > .decrease");n&&a&&(n.addEventListener("click",(function(){t.increaseQuantity(e)})),a.addEventListener("click",(function(){t.decreaseQuantity(e)})))}))},t.prototype.rememberQuantity=function(){var t=this,e=[];this.cardsNode.forEach((function(n,a){e[a]=t.getCardQuantity(n)})),localStorage.setItem("sc-cards-".concat(this.getPageId()),JSON.stringify(e))},t.prototype.getPageId=function(){var t;return"pageJson"in window?null===(t=null===window||void 0===window?void 0:window.pageJson)||void 0===t?void 0:t.campaignPageId:0},t.prototype.isDebug=function(){var t=new RegExp("[\\?&]debug=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},t.prototype.checkDebug=function(){this.isDebug()&&document.querySelector("body").setAttribute("data-debug","true")},t.prototype.run=function(){for(var t=this;!this.checkNested(window.EngagingNetworks,"require","_defined","enjs","setFieldValue");)return this.isDebug()&&console.log("4Site Shoppint Cart - Waiting for EngagingNetworks"),void window.setTimeout((function(){t.run()}),10);this.setCardsAtttributes(),this.createCardsAmounts(),this.createCardsQuantity(),this.watchForQuantityChanges(),this.setQuantityClickEvent(),this.addLiveVariables(),this.addOtherAmount(),this.addMonthlyCheckbox(),this.updateFrequency(),this.checkDebug(),window.setTimeout((function(){t.updateTotal()}),500)},t.prototype.checkNested=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var a=0;a<e.length;a++){if(!t||!Object.getOwnPropertyDescriptor(t,e[a]))return!1;t=t[e[a]]}return!0},t}())})();